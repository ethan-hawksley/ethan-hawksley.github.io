---
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';

interface Props {
  pageTitle: string;
  pageDescription: string;
  highlightedLink?: 'home' | 'blog';
  jsonLd?: Record<string, any>;
  robots?: string;
  ogType?: 'website' | 'article' | 'profile';
  article?: { publishedTime: string; modifiedTime?: string; tags: string[] };
}
const {
  pageTitle,
  pageDescription,
  highlightedLink,
  jsonLd,
  robots = 'index, follow, max-image-preview:large',
  ogType = 'website',
  article,
} = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, Astro.site);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <meta name="robots" content={robots} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Ethan Hawksley's Blog"
      href="/rss.xml"
    />
    <meta name="color-scheme" content="light dark" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta
      name="theme-color"
      content="#fafafa"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#0f0f0f"
      media="(prefers-color-scheme: dark)"
    />
    <link rel="canonical" href={canonicalUrl} />
    <meta name="author" content="Ethan Hawksley" />
    <meta property="profile:first_name" content="Ethan" />
    <meta property="profile:last_name" content="Hawksley" />
    <meta content={ogType} property="og:type" />
    {
      article && (
        <>
          <meta
            property="article:published_time"
            content={article.publishedTime}
          />
          <meta
            property="article:modified_time"
            content={article.modifiedTime ?? article.publishedTime}
          />
          <meta property="article:author" content="https://hawksley.dev" />
          {article.tags.map((tag) => (
            <meta property="article:tag" content={tag} />
          ))}
        </>
      )
    }
    <meta content={canonicalUrl} property="og:url" />
    <meta content={pageTitle} property="og:title" />
    <meta content={pageDescription} property="og:description" />
    <meta
      content="https://hawksley.dev/og-image-1200x630.png"
      property="og:image"
    />
    <meta property="og:image:alt" content={pageTitle} />
    <meta content="1200" property="og:image:width" />
    <meta content="630" property="og:image:height" />
    <meta content="Ethan Hawksley" property="og:site_name" />
    <meta property="og:locale" content="en_GB" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@Ethan_Hawksley" />
    <meta name="twitter:creator" content="@Ethan_Hawksley" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    <meta
      name="twitter:image"
      content="https://hawksley.dev/og-image-1200x630.png"
    />
    <meta name="twitter:image:alt" content={pageTitle} />
    <meta
      name="thumbnail"
      content="https://hawksley.dev/avatar-1200x1200.png"
    />
    <link
      rel="preload"
      href="/fonts/InterVariable.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <script is:inline>
      function getCurrentTheme() {
        const localTheme = localStorage.getItem('theme');
        if (localTheme) {
          return localTheme;
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      }
      let theme = getCurrentTheme();
      document.documentElement.classList.toggle('dark', theme === 'dark');
      const themeColorMetaTags = document.querySelectorAll(
        'meta[name="theme-color"]',
      );
      const newColor = theme === 'dark' ? '#0f0f0f' : '#fafafa';
      themeColorMetaTags.forEach((tag) =>
        tag.setAttribute('content', newColor),
      );

      window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
          document.documentElement.classList.add('enable-transitions');
        }, 0);
      });
    </script>
    {
      jsonLd && (
        <script
          type="application/ld+json"
          is:inline
          set:html={JSON.stringify(jsonLd)}
        />
      )
    }
  </head>
  <body>
    <div id="page">
      <div id="nav-bar">
        <Navigation highlightedLink={highlightedLink} />
      </div>
      <main>
        <slot />
      </main>
      <Footer />
    </div>
  </body>
</html>

<style is:global>
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  *:not(dialog) {
    margin: 0;
  }

  @media (prefers-reduced-motion: no-preference) {
    html {
      interpolate-size: allow-keywords;
    }
  }

  body {
    font-size: 1rem;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
    height: auto;
  }

  input,
  button,
  textarea,
  select {
    font: inherit;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
  }

  p {
    text-wrap: pretty;
  }
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    text-wrap: balance;
    text-rendering: optimizeLegibility;
  }

  :focus-visible {
    outline: 3px solid var(--color-accent);
    outline-offset: 4px;
  }

  ::selection {
    background-color: var(--color-accent);
    color: #fff;
  }

  p,
  li {
    max-width: 65ch;
  }

  a,
  button {
    transition: transform 0.1s ease;
    touch-action: manipulation;
  }

  a svg,
  button svg {
    pointer-events: none;
  }

  a:active,
  button:active {
    transform: scale(0.96);
  }

  html {
    scrollbar-color: var(--color-text-muted) var(--color-background);
  }

  ::-webkit-scrollbar {
    width: 10px;
  }

  ::-webkit-scrollbar-track {
    background: var(--color-background);
  }

  ::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
    border-radius: 10px;
    border: 2px solid var(--color-background);
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-text-muted);
  }

  :root {
    --color-background: #fafafa;
    --color-surface: #f0f0f0;
    --color-text: #1a1a1a;
    --color-text-muted: #525252;
    --color-accent: #d14100;
    --color-border: #e0e0e0;
  }
  :root.dark {
    --color-background: #0f0f0f;
    --color-surface: #1a1a1a;
    --color-text: #ededed;
    --color-text-muted: #b0b0b0;
    --color-accent: #ff4f00;
    --color-border: #2a2a2a;
  }
</style>
<style>
  @font-face {
    font-family: 'Inter';
    font-style: normal;
    font-weight: 100 900;
    font-display: optional;
    src: url('/fonts/InterVariable.woff2') format('woff2');
  }

  html {
    background-color: var(--color-background);
    color: var(--color-text);

    font-family:
      'Inter',
      -apple-system,
      BlinkMacSystemFont,
      'Segoe UI',
      Roboto,
      Oxygen,
      Ubuntu,
      Cantarell,
      'Helvetica Neue',
      Arial,
      sans-serif;

    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-optical-sizing: auto;
    text-rendering: optimizeSpeed;
    color-scheme: light dark;
    accent-color: var(--color-accent);
    scroll-behavior: smooth;
    scrollbar-gutter: stable;
  }

  html.enable-transitions {
    transition:
      background-color 250ms ease-out,
      color 250ms ease;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  #page {
    max-width: 900px;
    margin-inline: auto;
    padding-top: 1rem;
    padding-bottom: 1.5rem;

    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  #nav-bar {
    margin-bottom: 1.5rem;
  }

  main {
    max-width: 900px;
    margin-inline: auto;
    padding-inline: 1.5rem;
    width: 100%;

    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
</style>
