---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import PostPreview from '../../components/PostPreview.astro';
import { personSchema, websiteSchema } from '../../lib/schema.ts';

const allPosts = (await getCollection('posts')).sort((a, b) =>
  a.data.pubDate < b.data.pubDate ? 1 : -1,
);

const jsonLd = {
  '@context': 'https://schema.org',
  '@graph': [
    websiteSchema,
    {
      '@type': 'CollectionPage',
      '@id': 'https://hawksley.dev/blog/#webpage',
      url: 'https://hawksley.dev/blog/',
      name: "Ethan Hawksley's Blog",
      isPartOf: { '@id': 'https://hawksley.dev/#website' },
      mainEntity: { '@id': 'https://hawksley.dev/blog/#blog' },
      inLanguage: 'en-GB',
    },
    {
      '@type': 'Blog',
      '@id': 'https://hawksley.dev/blog/#blog',
      mainEntityOfPage: 'https://hawksley.dev/blog/',
      name: "Ethan Hawksley's Blog",
      description:
        'Technical blog of Ethan Hawksley, a UK-based CS student and developer. Explore articles on Rust, JavaScript, and computer science concepts.',
      publisher: { '@id': 'https://hawksley.dev/#person' },
      isPartOf: { '@id': 'https://hawksley.dev/#website' },
      inLanguage: 'en-GB',
      blogPost: allPosts.map((post) => ({
        '@type': 'BlogPosting',
        '@id': `https://hawksley.dev/blog/${post.id}/#article`,
        mainEntityOfPage: `https://hawksley.dev/blog/${post.id}/`,
        url: `https://hawksley.dev/blog/${post.id}/`,
        headline: post.data.title,
        description: post.data.description,
        image: 'https://hawksley.dev/og-image-1200x630.png?v=2',
        datePublished: post.data.pubDate.toISOString(),
        dateModified: (
          post.data.modifiedDate || post.data.pubDate
        ).toISOString(),
        author: {
          '@id': 'https://hawksley.dev/#person',
          '@type': 'Person',
          name: 'Ethan Hawksley',
          url: 'https://hawksley.dev/',
        },
        publisher: { '@id': 'https://hawksley.dev/#person' },
        keywords: post.data.tags,
        inLanguage: 'en-GB',
      })),
    },
    personSchema,
    {
      '@type': 'BreadcrumbList',
      itemListElement: [
        {
          '@type': 'ListItem',
          position: 1,
          name: 'Home',
          item: 'https://hawksley.dev/',
        },
        {
          '@type': 'ListItem',
          position: 2,
          name: 'Blog',
          item: 'https://hawksley.dev/blog/',
        },
      ],
    },
  ],
};
---

<Layout
  pageTitle="Blog | Ethan Hawksley"
  pageDescription="Technical blog of Ethan Hawksley, a UK-based CS student and developer. Explore articles on Rust, JavaScript, and computer science concepts."
  highlightedLink="blog"
  jsonLd={jsonLd}
  ogType="website"
>
  <h1>Blog</h1>
  <ul>
    {
      allPosts.map((post) => (
        <PostPreview
          url={`/blog/${post.id}/`}
          title={post.data.title}
          description={post.data.description}
          pubDate={post.data.pubDate}
          tags={post.data.tags}
        />
      ))
    }
  </ul>
</Layout>
<style>
  h1 {
    font-size: var(--font-size-2xl);
    margin-bottom: 1.5rem;
    text-decoration: var(--color-accent) underline 3px;
    text-underline-offset: 0.5rem;
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-tight);
  }

  ul {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 65ch;
  }
</style>
