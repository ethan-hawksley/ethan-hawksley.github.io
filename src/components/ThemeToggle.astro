---
import Moon from '../assets/moon.svg';
import Sun from '../assets/sun.svg';
---

<button id="theme-toggle" role="listitem" aria-label="Toggle dark mode">
  <Moon class="moon" aria-hidden="true" focusable="false" />
  <Sun class="sun" aria-hidden="true" focusable="false" />
</button>
<style>
  button {
    border: 0;
    background: none;
    cursor: pointer;
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sun,
  .moon {
    transition:
      color 0.3s ease,
      opacity 0.3s ease;
    color: var(--color-text);
    width: 2rem;
    height: 2rem;
    position: absolute;
  }

  .sun {
    opacity: 0;
  }

  :global(.dark) .moon {
    opacity: 0;
  }

  :global(.dark) .sun {
    opacity: 1;
  }

  button:hover > .sun,
  button:hover > .moon {
    color: var(--color-accent);
  }
</style>
<script>
  const button = document.getElementById('theme-toggle');

  function updateTheme(isDark: boolean) {
    button?.setAttribute(
      'aria-label',
      `Switch to ${isDark ? 'light' : 'dark'} mode`,
    );
    const themeColorMetaTags = document.querySelectorAll(
      'meta[name="theme-color"]',
    );
    const newColor = isDark ? '#0f0f0f' : '#fafafa';
    themeColorMetaTags.forEach((tag) => tag.setAttribute('content', newColor));
  }

  button?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    updateTheme(isDark);
  });

  updateTheme(document.documentElement.classList.contains('dark'));
</script>
